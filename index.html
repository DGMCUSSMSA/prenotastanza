<!DOCTYPE html>
<html>
<head>
  <title>Prenotazione Stanza Colloqui</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; }
    table { width: 80%; margin: auto; border-collapse: collapse; }
    th, td { border: 1px solid black; padding: 8px; }
  </style>
</head>
<body>
  <h2>Prenotazione Stanza Colloqui</h2>
  
  <h3>Disponibilità</h3>
  <table id="calendario">
    <tr><th>Nome</th><th>Data</th><th>Ora</th></tr>
  </table>
  
  <h3>Prenota un colloquio</h3>
  <form id="prenotazioneForm">
    <input type="text" id="nome" placeholder="Nome" required><br>
    <input type="date" id="data" required><br>
    <input type="time" id="ora" required><br>
    <input type="text" id="note" placeholder="Note (opzionale)"><br>
    <button type="submit">Prenota</button>
  </form>
  
  <p id="messaggio"></p>

  <script>
    function caricaDisponibilità() {
      google.script.run.withSuccessHandler(function(data) {
        let prenotazioni = JSON.parse(data);
        let tabella = document.getElementById("calendario");

        prenotazioni.forEach(evento => {
          let row = tabella.insertRow();
          row.insertCell(0).innerText = evento.titolo;
          row.insertCell(1).innerText = evento.data;
          row.insertCell(2).innerText = evento.ora;
        });
      }).getDisponibilità();
    }

    document.getElementById("prenotazioneForm").addEventListener("submit", function(event) {
      event.preventDefault();

      let dati = {
        nome: document.getElementById("nome").value,
        data: document.getElementById("data").value,
        ora: document.getElementById("ora").value,
        note: document.getElementById("note").value
      };

      google.script.run.withSuccessHandler(function(response) {
        document.getElementById("messaggio").innerText = response;
        caricaDisponibilità();
      }).prenotaColloquio(dati);
    });

    caricaDisponibilità();
  </script>
</body>
</html>
